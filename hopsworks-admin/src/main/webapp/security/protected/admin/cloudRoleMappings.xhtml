<?xml version="1.0" encoding="UTF-8"?>
<!--
 ~ Copyright (C) 2020, Logical Clocks AB. All rights reserved
 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Hopsworks - User Administration</title>
    <link rel="icon" type="image/png" href="#{resource['images/hopsworks-logo/HopsIconGreen.png']}"/>
    <link rel="stylesheet" type="text/css" href="#{resource['/css/main.css']}"/>
    <link rel="stylesheet" type="text/css" href="#{resource['/css/theme.css']}"/>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"/>
    <meta http-equiv="refresh"
          content="#{facesContext.externalContext.sessionMaxInactiveInterval};url=#{request.contextPath}/index.xhtml"/>
</h:head>
<h:body>
    <ui:insert name="titleBar">
        <ui:include src="/security/protected/admin/admintitleBar.xhtml"/>
    </ui:insert>
    <div class="container-lg">
    <div class="content" align="center">
        <h:form id="mappings_form" style="margin-top: 50px">
            <p:growl id="msgs" showDetail="true"/>
            <p:dataTable id="mappings" widgetVar="mappings" var="mapping"
                         value="#{cloudRoleMappingBean.cloudRoleMappings}"
                         editable="true"
                         rows="25"
                         paginator="true"
                         paginatorPosition="top"
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="15,25,35,45,55"
                         emptyMessage="No mapping found."
                         style="margin-bottom:20px">
                <f:facet name="header">
                    Cloud role to project mapping.
                </f:facet>

                <p:ajax event="rowEdit" listener="#{cloudRoleMappingBean.onRowEdit}"
                        update=":mappings_form:msgs"/>
                <p:ajax event="rowEditCancel" listener="#{cloudRoleMappingBean.onRowCancel}"
                        update=":mappings_form:msgs"/>

                <p:column headerText="ID"
                          filterBy="#{mapping.id}"
                          filterMatchMode="contains"
                          sortBy="#{mapping.id}">
                    <h:outputText value="#{mapping.id}" />
                </p:column>

                <p:column headerText="Project name"
                          filterBy="#{mapping.projectName}"
                          filterMatchMode="contains"
                          sortBy="#{mapping.projectName}">
                    <h:outputText value="#{mapping.projectName}" />
                </p:column>

                <p:column headerText="Project role"
                          filterBy="#{mapping.projectRole}"
                          filterMatchMode="contains"
                          sortBy="#{mapping.projectRole}">
                    <p:cellEditor>
                        <f:facet name="output"><h:outputText value="#{mapping.projectRole}"/></f:facet>
                        <f:facet name="input">
                            <h:selectOneMenu value="#{mapping.projectRole}" style="width:100%">
                                <f:selectItems value="#{cloudRoleMappingBean.projectRoles}" var="projectRole"
                                               itemLabel="#{projectRole.displayName}"
                                               itemValue="#{projectRole.displayName}"/>
                            </h:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Cloud role"
                          filterBy="#{mapping.cloudRole}"
                          filterMatchMode="contains"
                          sortBy="#{mapping.cloudRole}">
                    <p:cellEditor>
                        <f:facet name="output"><h:outputText value="#{mapping.cloudRole}"/></f:facet>
                        <f:facet name="input"><p:inputText id="cloudRole" value="#{mapping.cloudRole}"
                                                           style="width:100%"/></f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Default" styleClass="centeredColumnContent"
                          filterBy="#{mapping.defaultRole}"
                          sortBy="#{mapping.defaultRole}">
                    <f:facet name="filter">
                        <p:selectOneButton onchange="PF('mappings').filter()" styleClass="custom-filter">
                            <f:selectItem itemLabel="All" itemValue="" />
                            <f:selectItem itemLabel="True" itemValue="true" />
                            <f:selectItem itemLabel="False" itemValue="false" />
                        </p:selectOneButton>
                    </f:facet>
                    <p:cellEditor>
                        <f:facet name="output"><p:selectBooleanCheckbox value="#{mapping.defaultRole}" disabled="true"/></f:facet>
                        <f:facet name="input">
                            <p:selectBooleanCheckbox value="#{mapping.defaultRole}"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Action" style="width: 35px;">
                    <p:commandButton icon="ui-icon-trash" disabled="#{mapping.id == null}"
                                     title="Delete mapping"
                                     action="#{cloudRoleMappingBean.remove(mapping)}"
                                     update=":mappings_form :mappings_form:msgs">
                        <p:confirm header="Remove mapping"
                                   message="Are you sure you want to remove this mapping?"
                                   icon="ui-icon-alert"/>
                    </p:commandButton>
                </p:column>
                <p:column style="width:32px">
                    <p:rowEditor/>
                </p:column>
            </p:dataTable>
            <p:confirmDialog global="true" severity="alert" showEffect="fade">
                <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit"/>
                <p:commandButton value="No" icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/>
            </p:confirmDialog>
        </h:form>
        <h:form id="add_mapping_form">
            <div>
                <table class="ui-datatable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th class="ui-state-default" style="width: 25%;">Project name</th>
                            <th class="ui-state-default" style="width: 25%;">Project role</th>
                            <th class="ui-state-default" style="width: 40%;">Cloud role</th>
                            <th class="ui-state-default" style="width: 40%;">Default</th>
                            <th class="ui-state-default" style="width: 10%;">Action</th>
                        </tr>
                    </thead>
                    <tbody class="ui-datatable-data ui-widget-content">
                    <tr class="ui-widget-content ui-datatable-even ui-row-editing">
                        <td class="ui-editable-column" style="padding: 4px 10px">
                            <div class="ui-cell-editor">
                                <div class="ui-cell-editor-input">
                                    <h:selectOneMenu value="#{cloudRoleMappingBean.projectName}"
                                                     filterMatchMode="contains" style="width:100%">
                                        <f:selectItems value="#{cloudRoleMappingBean.projects}" var="project"
                                                       itemLabel="#{project.name}"
                                                       itemValue="#{project.name}"/>
                                    </h:selectOneMenu>
                                </div>
                            </div>
                        </td>
                        <td class="ui-editable-column" style="padding: 4px 10px">
                            <div class="ui-cell-editor">
                                <div class="ui-cell-editor-input">
                                    <h:selectOneMenu value="#{cloudRoleMappingBean.projectRole}" required="true" style="width: 100%;">
                                        <f:selectItems value="#{cloudRoleMappingBean.projectRoles}"
                                                       var="projectRole" itemLabel="#{projectRole.displayName}"
                                                       itemValue="#{projectRole}"/>
                                    </h:selectOneMenu>
                                </div>
                            </div>
                        </td>
                        <td class="ui-editable-column" style="padding: 4px 10px">
                            <div class="ui-cell-editor">
                                <div class="ui-cell-editor-input">
                                    <p:inputText id="cloud_role"
                                                 style="width: 96%;" value="#{cloudRoleMappingBean.cloudRole}"
                                                 required="true"/>
                                </div>
                            </div>
                        </td>
                        <td class="ui-editable-column" style="padding: 4px 10px; text-align: center;">
                            <div class="ui-cell-editor">
                                <div class="ui-cell-editor-input">
                                    <p:selectBooleanCheckbox id="default"
                                                             value="#{cloudRoleMappingBean.defaultRole}"/>
                                </div>
                            </div>
                        </td>
                        <td class="ui-editable-column" style="padding: 4px 10px">
                            <div class="ui-cell-editor ui-helper-clearfix">
                                <div class="ui-g-12">
                                    <p:commandButton icon="ui-icon-plus" style="width: 100%;"
                                                     update=":add_mapping_form :mappings_form"
                                                     action="#{cloudRoleMappingBean.onAddNew()}"/>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </h:form>
    </div>
    </div>
</h:body>
</html>