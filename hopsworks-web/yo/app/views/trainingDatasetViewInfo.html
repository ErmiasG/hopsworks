<!--
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2018, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  -->

<div>
    <div uib-accordion close-others="false">
        <div uib-accordion-group class="panel-default" is-open="true">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='Training Dataset Metadata'></i>
                <span style="margin-left: 20px">
                    Training Dataset Details
                </span>
            </div>

            <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto">
                <tbody class="fs-table">
                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Id
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.id}}
                    </td>
                </tr>
                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Name
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.name}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Version
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.version}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Description
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.description}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Feature Store
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.featurestoreName}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Creator
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.creator}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Created
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.created | date:'medium'}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Last Read
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.readLast.timestamp | date:'medium'}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Last Modified
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.writeLast.timestamp | date:'medium'}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Actions
                    </td>
                    <td class="fs-table">
                        <button class="btn btn-default fa fa-bar-chart"
                                uib-tooltip="View statistics"
                                ng-click="trainingDatasetViewInfoCtrl.viewTrainingDatasetStatistics(); $event.stopPropagation();"></button>

                        <button class="btn btn-default fa fa-edit" id="toolbar-edit"
                                uib-tooltip="Edit"
                                ng-click="trainingDatasetViewInfoCtrl.updateTrainingDataset(featurestoreCtrl); $event.stopPropagation();"></button>

                        <button class="btn btn-default fa fa-plus" id="toolbar-new"
                                uib-tooltip="New"
                                ng-click="trainingDatasetViewInfoCtrl.newTrainingDatasetVersion(featurestoreCtrl); $event.stopPropagation();"></button>

                        <button class="btn btn-default fa fa-trash-o"
                                uib-tooltip="Delete"
                                ng-click="trainingDatasetViewInfoCtrl.deleteTrainingDataset(featurestoreCtrl); $event.stopPropagation();"></button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div uib-accordion-group class="panel-default">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='Details about how the Training Dataset is stored.'></i>
                <span style="margin-left: 20px">
                    Storage Details
                </span>
            </div>

            <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto">
                <tbody class="fs-table">
                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Location
                    </td>
                    <td class="fs-table">
                        <span ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.trainingDatasetType !== trainingDatasetViewInfoCtrl.externalTrainingDatasetType">
                            <a ng-click="trainingDatasetViewInfoCtrl.tdLocation()">
                            {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.location}}
                            </a>
                        </span>
                        <span ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.trainingDatasetType == trainingDatasetViewInfoCtrl.externalTrainingDatasetType">
                            {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.location}}
                        </span>
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Data format
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.dataFormat}}
                    </td>
                </tr>

                <tr class="fs-table" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.trainingDatasetType == trainingDatasetViewInfoCtrl.hopsfsTrainingDatasetType">
                    <td style="font-weight:700;" class="fs-table">
                        Size
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.size}}
                        <i ng-if="trainingDatasetViewInfoCtrl.sizeWorking" style="margin-top: 2px; text-align: center;"
                           class="fa fa-spinner fa-spin"></i>
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        <span ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.trainingDatasetType == trainingDatasetViewInfoCtrl.hopsfsTrainingDatasetType">HopsFS Storage Connector Name</span>
                        <span ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.trainingDatasetType == trainingDatasetViewInfoCtrl.externalTrainingDatasetType">S3 Storage Connector Name</span>
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.storageConnectorName}}
                    </td>
                </tr>

                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        <span ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.trainingDatasetType == trainingDatasetViewInfoCtrl.hopsfsTrainingDatasetType">HopsFS Storage Connector Id</span>
                        <span ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.trainingDatasetType == trainingDatasetViewInfoCtrl.externalTrainingDatasetType">S3 Storage Connector Id</span>
                    </td>
                    <td class="fs-table">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.storageConnectorId}}
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div uib-accordion-group class="panel-default">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='Details about the splits in which the Training Dataset is stored.'></i>
                <span style="margin-left: 20px">
                    Splits
                </span>
            </div>

            <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto"
                   ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.splits.length > 0">
                <tbody class="fs-table">
                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Seed
                    </td>
                    <td class="fs-table" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.seed != null">
                        {{trainingDatasetViewInfoCtrl.selectedTrainingDataset.seed}}
                    </td>
                    <td class="fs-table" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.seed == null">
                        undefined
                    </td>
                </tr>
                </tbody>
            </table>

            <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto"
                   ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.splits.length > 0">
                <thead style="border:none;" class="fs-table">
                <th class="fs-table" style="width: 20%">Split Name</th>
                <th class="fs-table" style="width: 20%">Percentage</th>
                </thead>
                <tbody>
                <tr class="fs-table"
                    data-ng-repeat="split in trainingDatasetViewInfoCtrl.selectedTrainingDataset.splits">
                    <td class="fs-table"> {{split.name}}</td>
                    <td class="fs-table"> {{split.percentage}}</td>
                </tr>
                </tbody>
            </table>

            <h4 style="margin-left: 10px"
                ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.splits.length == 0">
                This training dataset does not contain separate splits</h4>
        </div>

        <div uib-accordion-group class="panel-default">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='Hopsworks Jobs that update the Training Dataset in some way'></i>
                <span style="margin-left: 20px">
                    Jobs
                </span>
            </div>

            <h3 style="margin-left: 10px" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.writeHistory.length === 0">
                No jobs have written to this Training Dataset
            </h3>

            <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.writeHistory.length > 0">
                <thead style="border:none;" class="fs-table">
                <th class="fs-table" style="width: 50%">Job Name</th>
                <th class="fs-table" style="width: 25%">Status</th>
                <th class="fs-table" style="width: 25%">Date</th>
                </thead>
                <tbody class="fs-table">
                <tr class="fs-table"
                    data-ng-repeat="usage in trainingDatasetViewInfoCtrl.selectedTrainingDataset.writeHistory">
                    <td class="fs-table"> <span> {{usage.job.name}} </span> </td>
                    <td class="fs-table"> <span> {{usage.execution.state}} </span> </td>
                    <td class="fs-table"> <span> {{usage.execution.submissionTime | date:'medium'}} </span> </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div uib-accordion-group class="panel-default">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='API for reading the training dataset programmatically'></i>
                <span style="margin-left: 20px">
                    API
                </span>
            </div>

            <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto">
                <tbody class="fs-table">
                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Python API
                    </td>
                    <td class="fs-table">
<pre>
<code>{{trainingDatasetViewInfoCtrl.pythonCode}}</code>
</pre>
                    </td>
                </tr>
                <tr class="fs-table">
                    <td style="font-weight:700;" class="fs-table">
                        Scala API
                    </td>
                    <td class="fs-table">
<pre>
<code>{{trainingDatasetViewInfoCtrl.scalaCode}}</code>
</pre>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div uib-accordion-group class="panel-default">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='The Training Dataset Schema'></i>
                <span style="margin-left: 20px">
                    Schema
                </span>
            </div>

            <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto"
                   ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.features.length > 0">
                <thead style="border:none;" class="fs-table">
                <th class="fs-table" style="width: 35%">Feature Name</th>
                <th class="fs-table" style="width: 20%">Feature Type</th>
                <th class="fs-table" style="width: 10%">Label</th>
                <th class="fs-table" style="width: 35%">Feature Group</th>
                <th class="fs-table" style="width: 10%"> </th>
                </thead>
                <tbody>
                <tr class="fs-table" data-ng-repeat="feature in trainingDatasetViewInfoCtrl.selectedTrainingDataset.features">
                    <td class="fs-table"> {{feature.name}}</td>
                    <td class="fs-table"> {{feature.type}}</td>
                    <td class="fs-table"> {{feature.label}}</td>
                    <td class="fs-table"><a ng-if="feature.featuregroup != null" ng-click="trainingDatasetViewInfoCtrl.goToFeaturegroup(feature.featuregroup)">{{feature.featuregroup.name}}</a></td>
                    <td class="fs-table">
                        <i class="fa fa-info-circle" tooltip-placement="auto left" 
                           ng-if="feature.featuregroup != null"
                            uib-tooltip="featurestore: {{feature.featuregroup.featurestoreName}} featuregroup: {{ feature.featuregroup.name }} version: {{ feature.featuregroup.version }}"
                            style="margin-left: 10px"></i>
                    </td>
                </tr>
                </tbody>
            </table>
            <h3 style="margin-left: 10px" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.features.length == 0">
                This training dataset does not have a defined schema</h3>
        </div>

        <div uib-accordion-group class="panel-default">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='Provenance Information for the Training Dataset'></i>
                <span style="margin-left: 20px">
                    Provenance
                </span>
            </div>

            <div>
                <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto">
                    <thead style="border:none;" class="fs-table">
                    <th class="fs-table" style="width: 20%">
                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                           uib-tooltip='Feature Groups used to generate this Training Dataset. Format: <project_name> : <application_id> : <feature group name> : <feature group version>'></i>
                        <span style="margin-left: 20px">
                            Source Feature Groups
                        </span>
                    </th>
                    </thead>
                    <tbody>
                    <tr class="fs-table"data-ng-repeat="fg in trainingDatasetViewInfoCtrl.selectedTrainingDataset.fgLinks">
                        <td class="fs-table"><a ng-click="trainingDatasetViewInfoCtrl.goToFeaturegroup(fg)">{{fg.projName}} : {{fg.appId}} : {{fg.name}} : {{fg.version}}</a></td>
                    </tr>
                    <tr class="fs-table" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.fgLinks.length == 0">
                        <td class="fs-table">No registered Feature Groups were used to generate this Training Dataset.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div>
                <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto">
                    <thead style="border:none;" class="fs-table">
                    <th class="fs-table" style="width: 20%">
                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                           uib-tooltip='Models generated from this Training Dataset. Format: <project_name> : <application_id> : <model name> : <model version>'></i>
                        <span style="margin-left: 20px">
                            Generated Models
                        </span>
                    </th>
                    </thead>
                    <tbody>
                    <tr class="fs-table" data-ng-repeat="model in trainingDatasetViewInfoCtrl.selectedTrainingDataset.modelLinks">
                        <td class="fs-table"><a
                                ng-click="trainingDatasetViewInfoCtrl.goToModel(model)">{{model.projName}} : {{model.appId}} : {{model.name}} : {{model.version}}</a></td>
                    </tr>
                    <tr class="fs-table" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.modelLinks.length == 0">
                        <td class="fs-table">No Models generated from this Training Dataset.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div>
                <table class="table table-hover fs-table" style="margin-left: 10px; overflow: auto">
                    <thead style="border:none;" class="fs-table">
                    <th class="fs-table" style="width: 20%">
                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                           uib-tooltip='Experiments using this Training Dataset. Format: <project_name> : <experiment application> : <experiment version>'></i>
                        <span style="margin-left: 20px">
                            Experiments using the Training Dataset
                        </span>
                    </th>
                    </thead>
                    <tbody>
                    <tr class="fs-table" data-ng-repeat="experiment in trainingDatasetViewInfoCtrl.selectedTrainingDataset.experimentLinks">
                        <td class="fs-table"><a ng-click="trainingDatasetViewInfoCtrl.goToExperiment(experiment)">{{experiment.projName}} : {{experiment.name}} : {{experiment.version}}</a></td>
                    </tr>
                    <tr class="fs-table" ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.experimentLinks.length == 0">
                        <td class="fs-table">No Experiments using this Training Dataset.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div uib-accordion-group class="panel-default">
            <div uib-accordion-heading>
                <i class="fa fa-info-circle" tooltip-placement="auto left"
                   uib-tooltip='The query used to generated this training dataset'></i>
                <span style="margin-left: 20px">
                    Query 
                </span>
            </div>

            <div ng-if="trainingDatasetViewInfoCtrl.selectedTrainingDataset.fromQuery">
<pre>
<code>{{trainingDatasetViewInfoCtrl.tdQuery}}</code>
</pre>
                <i ng-if="trainingDatasetViewInfoCtrl.tdQuery == null" 
                   style="margin-top: 2px; text-align: center;" class="fa fa-spinner fa-spin"></i>
            </div>
 

            <h3 style="margin-left: 10px" ng-if="!trainingDatasetViewInfoCtrl.selectedTrainingDataset.fromQuery">
                This training dataset was not generated from a HSFS query
            </h3>
        </div>
    </div>
</div>
